name: Update process of the PR

on:
  pull_request:
    branches: [ develop ]
    types: [ open, synchronize ]

jobs:
  save-snapshot:

    runs-on: ubuntu-latest
    if: ${{ startsWith(github.head_ref, 'feature/') }}

    steps:

    - uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Attach HEAD
      run: git checkout ${{ github.head_ref }}

    - name: Create snapshot
      shell: bash
      run: |
        branch=${{ github.head_ref }}
        snapshot=snapshot${branch#feature}
        [ -n "$(git branch -r | sed 's/ //g' | grep -e ^origin/$snapshot)" ] && git push origin $snapshot --delete
        git checkout -b $snapshot
        git push origin $snapshot
